# List of Changes

## Version 3.4.0

### New Features

- Microsoft SEAL can use [ZLIB](https://github.com/madler/zlib), a data compression library,
to automatically compress data that is serialized. This applies to every serializable object
in Microsoft SEAL. This feature must be enabled by the user. See more explanation of the compression
mechanism in [README.md](README.md#zlib). Microsoft SEAL does not redistribute ZLIB.
- AES-128 is replaced with the BLAKE2 family of hash functions in the pseudorandom number generator,
as BLAKE2 provides better cross-platform support. Microsoft SEAL redistributes the
[reference implementation of BLAKE2](https://github.com/BLAKE2/BLAKE2)
with light modifications to silence some misleading warnings in Visual Studio. The reference
implementation of BLAKE2 is licensed under
[CC0 1.0 Universal](https://github.com/BLAKE2/BLAKE2/blob/master/COPYING); see license boilerplates
in files [native/src/seal/util/blake*](native/src/seal/util/).
- The serialization functionality has been completely rewritten. Every serialized Microsoft SEAL
object starts with a 16-byte `Serialization::SEALHeader` struct, and then includes the data for
the object member variables. Every serializable object can now also be directly serialized into
a memory buffer instead of a C++ stream. This improves serialization for .NET and makes it much
easier to wrap the serialization functionality in other languages, e.g., Java. Unfortunately,
old serialized Microsoft SEAL objects are incompatible with the new format. If necessary, it should
be very easy to create a conversion utility.
- A ciphertext encrypted with a secret key, for example, a keyswitching key, has one component
generated by the PRNG. By using a seeded PRNG, this component can be replaced with the random seed
used by the PRNG to reduce data size. After transmitted to another party with Microsoft SEAL, the
component can be restored (regenerated) with the same seed. The security of using seeded PRNG is
enhanced by switching to BLAKE2 hash function with a 512-bit seed from AES with a 128-bit key.
- `Encryptor` now can be constructed with a secret key. This enables symmetric key encryption which
has methods that serialize ciphertexts (compressed with a seed) to a C++ stream or a memory buffer.
- The CMake system has been improved. For example, multiple versions of Microsoft SEAL can now be
installed on the same system easily, as the default installation directory and library filename now
depend on the version of Microsoft SEAL. Examples and unit tests can now be built without installing
the library.

### API Changes

**Wei/Kim: There are so many API changes, e.g. removing `unsafe_load`. Wait until final version.**

In class `Plaintext`:

In class `Ciphertext`:

In class `Encryptor`:

In class `UniformRandomGenerator`:

New class `Serialization`:

New files:
- [native/src/seal/util/rlwe.h](native/src/seal/util/rlwe.h)
- [native/src/seal/util/blake2.h](native/src/seal/util/blake2.h)
- [native/src/seal/util/blake2-impl.h](native/src/seal/util/blake2-impl.h)
- [native/src/seal/util/blake2b.c](native/src/seal/util/blake2b.c)
- [native/src/seal/util/blake2xb.c](native/src/seal/util/blake2xb.c)
- [native/src/seal/util/croots.cpp](native/src/seal/util/croots.cpp)
- [native/src/seal/util/croots.h](native/src/seal/util/croots.h)
- [native/src/seal/util/scalingvariant.cpp](native/src/seal/util/scalingvariant.cpp)
- [native/src/seal/util/scalingvariant.h](native/src/seal/util/scalingvariant.h)
- [native/src/seal/util/ztools.cpp](native/src/seal/util/ztools.cpp)
- [native/src/seal/util/ztools.h](native/src/seal/util/ztools.h)
- [native/src/seal/serialization.cpp](native/src/seal/serialization.cpp)
- [native/src/seal/serialization.h](native/src/seal/serialization.h)
- [native/tests/seal/serialization.cpp](native/tests/seal/serialization.cpp)
- [dotnet/native/sealnet/serialization_wrapper.cpp](dotnet/native/sealnet/serialization_wrapper.cpp)
- [dotnet/native/sealnet/serialization_wrapper.h](dotnet/native/sealnet/serialization_wrapper.h)
- [dotnet/src/Serialization.cs](dotnet/src/Serialization.cs)

Removed files:
- [native/src/seal/util/hash.cpp](native/src/seal/util/hash.cpp)

### Minor Bug and Typo Fixes

- Function `encrypt_zero_asymmetric` in [native/src/seal/util/rlwe.h](native/src/seal/util/rlwe.h)
handles `is_ntt_form == false` correctly.
- Invariant noise calculation in BFV is now correct when the plaintext modulus is large and
ciphertexts are fresh (reported in [issue 59](https://github.com/microsoft/SEAL/issues/59)).
- Fixed comments in [native/src/seal/util/smallntt.cpp](native/src/seal/util/smallntt.cpp) as
reported in [issue 56](https://github.com/microsoft/SEAL/issues/56).
- `GaloisKeys` can no longer be created with encryption parameters that do not support batching.

## Version 3.3.2 (patch)

### Minor Bug and Typo Fixes

- Switched to using RNS rounding instead of RNS flooring to fix the CKKS accuracy issue reported in [issue 52](https://github.com/microsoft/SEAL/issues/52).
- Added support for QUIET option in CMake (`find_package(seal QUIET)`).
- Using `[[nodiscard]]` attribute when compiling as C++17.
- Fixed a bug in `Evaluator::multiply_many` where the input vector was changed.

## Version 3.3.1 (patch)

### Minor Bug and Typo Fixes

- A bug was fixed that introduced significant extra inaccuracy in CKKS when compiled on Linux, at least with some versions of glibc; Windows and macOS were not affected.
- A bug was fixed where, on 32-bit platforms, some versions of GCC resolved the util::reverse_bits function to the incorrect overload.

## Version 3.3.0

### New Features

In this version, we have significantly improved the usability of the CKKS
scheme in Microsoft SEAL and many of these improvements apply to the BFV
scheme as well. Homomorphic operations that are based on key switching,
i.e., relinearization and rotation, do not consume any noise budget (BFV)
or impact accuracy (CKKS). The implementations of these operations are
significantly simplified and unified, and no longer use bit decomposition,
so decomposition bit count is gone. Moreover, fresh ciphertexts now have
lower noise. These changes have an effect on the API and it will
be especially worthwhile for users of older versions of the library to study
the examples and comments in
[native/examples/3_levels.cpp](native/examples/3_levels.cpp) (C++) or
[dotnet/examples/3_Levels.cs](dotnet/examples/3_Levels.cs) (C#).

The setup of `EncryptionParameters` has been made both easier and safer
(see [API Changes](#api-changes) below).

The examples in [native/examples/](native/examples/) and
[dotnet/examples/](dotnet/examples/) have been redesigned to better teach
the multiple technical concepts required to use Microsoft SEAL correctly and
efficiently, and more compactly demonstrate the API.

### API Changes

Deleted header files:
- native/defaultparameters.h

New header files:
- [native/src/seal/kswitchkeys.h](native/src/seal/kswitchkeys.h): new base class for `RelinKeys` and `GaloisKeys`)
- [native/src/seal/modulus.h](native/src/seal/modulus.h): static helper functions for parameter selection
- [native/src/seal/valcheck.h](native/src/seal/valcheck.h): object validity check functionality
- [native/src/seal/util/rlwe.h](native/src/seal/util/rlwe.h)

In class `SEALContext`:
- Replaced `context_data(parms_id_type)` with `get_context_data(parms_id_type)`;
- Removed `context_data()`;
- Added `key_context_data()`, `key_parms_id()`, `first_context_data()`, and `last_context_data()`;
- Added `using_keyswitching()` that indicates whether key switching is upported in this `SEALContext`;
- `Create(...)` in C++, and constructor in C#, now accepts an optional security level based on
[HomomorphicEncryption.org](https://HomomorphicEncryption.org) security standard, causing it to enforce the specified security level. By default a 128-bit security level is used.
- Added `prev_context_data()` method to class `ContextData` (doubly linked modulus switching chain);
- In C# `SEALContext` now has a public constructor.

Parameter selection:
- Removed the `DefaultParams` class;
- Default `coeff_modulus` for the BFV scheme are now accessed through the function `CoeffModulus::BFVDefault(...)`. These moduli are not recommended for the CKKS scheme;
- Customized `coeff_modulus` for the CKKS scheme can be created using `CoeffModulus::Create(...)` which takes the `poly_modulus_degree` and a vector of bit-lengths of the prime factors as arguments. It samples suitable primes close to 2^bit_length and returns a vector of `SmallModulus` elements.
- `PlainModulus::Batching(...)` can be used to sample a prime for `plain_modulus` that supports `BatchEncoder` for the BFV scheme.

Other important changes:
- Removed `size_capacity` function and data members from `Ciphertext` class;
- Moved all validation methods such as `is_valid_for` and `is_metadata_valid_for` to `valcheck.h`;
- Removed argument `decomposition_bit_count` from methods `relin_keys(...)` and `galois_keys(...)` in class `KeyGenerator`;
- It is no longer possible to create more than one relinearization key. This is to simplify the API and reduce confusion. We have never seen a real use-case where more relinearization keys would be a good idea;
- Added methods to generate an encryption of zero to `Encryptor`;
- Added comparison methods and primality check for `SmallModulus`;
- Classes `RelinKeys` and `GaloisKeys` are now derived from a common base class `KSwitchKeys`;
- GoogleTest framework is now included as a Git submodule;
- Numerous bugs have been fixed, particularly in the .NET wrappers.

## Version 3.2
